<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ukraine365 - Знайди свою ідеальну подорож</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9; 
            --secondary: #00b894;
            --secondary-dark: #00a184;
            --dark: #2d3436;
            --light: #f8f9fa;
            --light-gray: #e9ecef;
            --accent: #fdcb6e;
            --accent-dark: #f39c12;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #2ecc71;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --border-radius: 12px;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent-dark));
            background-size: 200% 200%;
            animation: gradientAnimation 10s ease infinite;
            color: white;
            text-align: center;
            padding: 3rem 0;
            position: relative;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        
        header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.5px;
        }
        
        header p {
            font-size: 1.25rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .language-switcher {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            backdrop-filter: blur(5px);
        }
        
        .language-switcher:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .interest-selector {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            transition: transform 0.3s;
        }
        
        .interest-selector:hover {
            transform: translateY(-5px);
        }
        
        h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
            font-weight: 600;
            font-size: 1.8rem;
        }
        
        .interests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }
        
        .interest-option {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: 16px;
            padding: 1.2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interest-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .interest-option.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .interest-option i {
            font-size: 2.2rem;
            margin-bottom: 0.8rem;
            display: block;
            transition: transform 0.3s;
        }
        
        .interest-option:hover i {
            transform: scale(1.2);
        }
        
        .interest-option span {
            font-weight: 500;
        }
        
        button {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
            gap: 2rem;
        }
        
        .place-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .place-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }
        
        .place-img {
            height: 220px;
            overflow: hidden;
            position: relative;
        }
        
        .place-img::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
        }
        
        .place-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }
        
        .place-card:hover .place-img img {
            transform: scale(1.1);
        }
        
        .place-info {
            padding: 1.8rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .place-info h3 {
            margin-bottom: 0.75rem;
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .place-info p {
            color: var(--text-secondary);
            margin-bottom: 1.2rem;
            line-height: 1.7;
            flex-grow: 1;
        }
        
        .place-details {
            margin-bottom: 1.2rem;
        }
        
        .place-details p {
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .place-details i {
            color: var(--primary);
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: auto;
        }
        
        .tag {
            background: var(--light-gray);
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-primary);
            transition: all 0.3s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag i {
            font-size: 0.7rem;
            color: var(--primary);
        }
        
        .tag.selected {
            background: var(--primary);
            color: white;
        }
        
        .tag.selected i {
            color: white;
        }
        
        footer {
            background-color: var(--dark);
            color: white;
            margin-top: 3rem;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem 2rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 3rem;
        }
        
        .footer-logo h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .footer-logo p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }
        
        .footer-links {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .footer-links-column h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .footer-links-column h4::after {
            display: none;
        }
        
        .footer-links-column ul {
            list-style: none;
        }
        
        .footer-links-column ul li {
            margin-bottom: 0.8rem;
        }
        
        .footer-links-column ul li a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.95rem;
            position: relative;
            padding-left: 0;
        }
        
        .footer-links-column ul li a:hover {
            color: var(--accent);
            padding-left: 5px;
        }
        
        .footer-links-column ul li a::before {
            content: '→';
            position: absolute;
            left: -20px;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .footer-links-column ul li a:hover::before {
            opacity: 1;
            left: -15px;
            color: var(--accent);
        }
        
        .social-icons {
            display: flex;
            gap: 1rem;
        }
        
        .social-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .social-icon:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 0;
            text-align: center;
        }
        
        .copyright {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .footer-container {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 2rem 1.5rem 1.5rem;
            }
            
            .footer-links {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .footer-logo h3 {
                font-size: 1.5rem;
            }
        }
        
        .footer-links-column.social-links {
            display: block;
        }
        
        .footer-links-column.social-links h4 {
            padding-left: 0;
            margin-left: 0;
            text-align: left;
        }
        
        .footer-links-column.social-links .social-icons {
            margin-left: 0;
            padding-left: 0;
            justify-content: flex-start;
        }
        
        .hidden {
            display: none;
        }
        
        #map-container {
            margin-top: 2rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        #map {
            height: 600px;
            width: 100%;
            z-index: 1;
        }
        
        .view-map-btn {
            margin-top: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        .map-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .map-controls button {
            padding: 10px 20px;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .interests-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .interest-option {
                padding: 0.6rem 0.4rem;
                border-radius: 10px;
            }
            
            .interest-option i {
                font-size: 1.3rem;
                margin-bottom: 0.3rem;
            }
            
            .interest-option span {
                font-size: 0.75rem;
            }
            
            .recommendations {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
            
            header p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            #map {
                height: 450px;
            }
            
            .container {
                padding: 1rem;
            }
            
            .language-switcher {
                position: absolute;
                top: 0.8rem;
                right: 0.8rem;
                padding: 0.3rem 0.8rem;
                font-size: 0.8rem;
                border-radius: 20px;
            }
        }
        
        .safety-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
            background: var(--light-gray);
            padding: 6px 12px;
            border-radius: 30px;
            width: fit-content;
        }
        
        .safety-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }
        
        .safety-high {
            background-color: var(--success);
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.2);
        }
        
        .safety-medium {
            background-color: var(--warning);
            box-shadow: 0 0 0 2px rgba(243, 156, 18, 0.2);
        }
        
        .safety-low {
            background-color: var(--danger);
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        }
        
        .safety-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .front-line-info {
            background-color: rgba(231, 76, 60, 0.1);
            border-left: 3px solid var(--danger);
            padding: 15px 20px;
            margin: 15px 0;
            font-size: 0.95rem;
            border-radius: 6px;
            color: var(--text-secondary);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .front-line-info i {
            color: var(--danger);
            margin-right: 8px;
        }
        
        .front-line-info strong {
            color: var(--danger);
        }
        
        .map-legend {
            position: absolute;
            bottom: 25px;
            right: 15px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 260px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            border-radius: 3px;
            flex-shrink: 0;
        }
        
        .legend-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary);
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 8px;
            font-size: 1rem;
        }
        
        .combat-zone {
            background-color: rgba(231, 76, 60, 0.15);
            border: 3px dashed #e74c3c;
        }
        
        .pulsating-circle {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--danger);
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 rgba(231, 76, 60, 0.4);
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }
            70% {
                transform: scale(2);
                opacity: 0;
                box-shadow: 0 0 0 15px rgba(231, 76, 60, 0);
            }
            100% {
                transform: scale(0.8);
                opacity: 0;
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }
        
        .danger-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.3));
        }
        
        .combat-zone-label {
            font-weight: bold;
            color: var(--danger);
            font-size: 12px;
            text-shadow: 0px 0px 3px white, 0px 0px 3px white, 0px 0px 3px white, 0px 0px 3px white;
            white-space: nowrap;
            letter-spacing: 0.5px;
            filter: drop-shadow(0px 1px 1px rgba(0, 0, 0, 0.3));
        }
        
        /* Стилі для попапів на карті */
        .leaflet-popup-content-wrapper {
            border-radius: 10px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .leaflet-popup-content {
            margin: 0;
            padding: 0;
        }
        
        .map-popup {
            padding: 15px;
        }
        
        .map-popup h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .map-popup p {
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .leaflet-popup-tip {
            background: white;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Стилі для контролерів карти */
        .leaflet-control-zoom {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .leaflet-control-zoom a {
            background-color: white;
            color: var(--primary);
            transition: all 0.3s;
        }
        
        .leaflet-control-zoom a:hover {
            background-color: var(--primary);
            color: white;
        }
        
        /* Покращення стилів для повідомлень */
        .no-results {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        /* Стиль для header з анімацією */
        @keyframes gradientAnimation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        /* Стилі для AI-чату */
        .chat-container {
            margin-top: 2rem;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
            height: auto;
            max-height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header span {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-body {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            height: 350px;
            background-color: #f8f9fa;
        }
        
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 30px;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s;
        }
        
        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .chat-send-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .chat-message-user {
            justify-content: flex-end;
        }
        
        .chat-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .chat-avatar-bot {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .chat-avatar-user {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
        }
        
        .chat-bubble {
            max-width: 70%;
            padding: 0.8rem 1.2rem;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
        }
        
        .chat-bubble-bot {
            background-color: white;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .chat-bubble-user {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .chat-timestamp {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: right;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 10px 0;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 50%;
            display: inline-block;
            animation: typingAnimation 1.5s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        .chat-toggle-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.7rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chat-toggle-btn::after {
            content: "AI";
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--accent);
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            padding: 5px 8px;
            border-radius: 30px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        .chat-toggle-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .chat-toggle-btn i {
            transition: all 0.3s;
        }
        
        .chat-toggle-btn:hover i {
            transform: scale(1.1);
        }
        
        .chat-toggle-btn.pulse {
            animation: pulse-animation 2s infinite;
        }
        
        @keyframes pulse-animation {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(52, 152, 219, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }
        
        @media (max-width: 768px) {
            .chat-container {
                max-height: 500px;
            }
            
            .chat-body {
                height: 280px;
            }
            
            .chat-toggle-btn {
                width: 60px;
                height: 60px;
                font-size: 1.4rem;
                bottom: 20px;
                right: 20px;
            }
            
            .chat-bubble {
                max-width: 80%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <h1 class="lang-uk">Ukraine365</h1>
        <h1 class="lang-en" style="display: none;">Ukraine365</h1>
        <p class="lang-uk">Знайди ідеальне місце для подорожі в Україні на основі твоїх інтересів</p>
        <p class="lang-en" style="display: none;">Find your perfect travel destination in Ukraine based on your interests</p>
        <button class="language-switcher" id="lang-switch">English</button>
    </header>
    
    <div class="container">
        <section class="interest-selector">
            <h2 class="lang-uk">Що тебе цікавить?</h2>
            <h2 class="lang-en" style="display: none;">What are you interested in?</h2>
            <div class="interests-grid">
                <div class="interest-option" data-interest="nature">
                    <i class="fas fa-tree"></i>
                    <span class="lang-uk">Природа</span>
                    <span class="lang-en" style="display: none;">Nature</span>
                </div>
                <div class="interest-option" data-interest="history">
                    <i class="fas fa-landmark"></i>
                    <span class="lang-uk">Історія</span>
                    <span class="lang-en" style="display: none;">History</span>
                </div>
                <div class="interest-option" data-interest="adventure">
                    <i class="fas fa-hiking"></i>
                    <span class="lang-uk">Пригоди</span>
                    <span class="lang-en" style="display: none;">Adventure</span>
                </div>
                <div class="interest-option" data-interest="culture">
                    <i class="fas fa-theater-masks"></i>
                    <span class="lang-uk">Культура</span>
                    <span class="lang-en" style="display: none;">Culture</span>
                </div>
                <div class="interest-option" data-interest="gastronomy">
                    <i class="fas fa-utensils"></i>
                    <span class="lang-uk">Гастрономія</span>
                    <span class="lang-en" style="display: none;">Gastronomy</span>
                </div>
                <div class="interest-option" data-interest="relax">
                    <i class="fas fa-spa"></i>
                    <span class="lang-uk">Відпочинок</span>
                    <span class="lang-en" style="display: none;">Relaxation</span>
                </div>
                <div class="interest-option" data-interest="architecture">
                    <i class="fas fa-city"></i>
                    <span class="lang-uk">Архітектура</span>
                    <span class="lang-en" style="display: none;">Architecture</span>
                </div>
                <div class="interest-option" data-interest="festivals">
                    <i class="fas fa-music"></i>
                    <span class="lang-uk">Фестивалі</span>
                    <span class="lang-en" style="display: none;">Festivals</span>
                </div>
            </div>
            <button id="find-button" class="lang-uk">Знайти ідеальні місця</button>
            <button id="find-button-en" class="lang-en" style="display: none;">Find perfect places</button>
        </section>
        
        <section id="results" class="hidden">
            <h2 class="lang-uk">Рекомендовані місця</h2>
            <h2 class="lang-en" style="display: none;">Recommended places</h2>
            <div class="recommendations" id="recommendations-container">
                <!-- Recommendations will be inserted here by JavaScript -->
            </div>
            
            <button class="view-map-btn lang-uk" id="view-map-btn">Переглянути на карті</button>
            <button class="view-map-btn lang-en" id="view-map-btn-en" style="display: none;">View on map</button>
            
            <div id="map-container" class="hidden">
                <div id="map"></div>
                <div class="front-line-info">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <span class="lang-uk"><strong>Увага!</strong> Дані про лінію фронту є орієнтовними. 
                    Перед подорожжю завжди перевіряйте актуальну інформацію про безпеку в офіційних джерелах.</span>
                    <span class="lang-en" style="display: none;"><strong>Warning!</strong> Front line data is approximate. 
                    Always check current safety information from official sources before traveling.</span>
                </div>
            </div>
        </section>
        
        <!-- AI-чат для подорожей -->
        <section id="chat-section" class="hidden">
            <h2 class="lang-uk">Допомога з плануванням</h2>
            <h2 class="lang-en" style="display: none;">Travel Planning Help</h2>
            
            <div class="chat-container">
                <div class="chat-header">
                    <span class="lang-uk"><i class="fas fa-robot"></i> Ukraine365 AI Асистент</span>
                    <span class="lang-en" style="display: none;"><i class="fas fa-robot"></i> Ukraine365 AI Assistant</span>
                </div>
                <div class="chat-body" id="chat-body">
                    <div class="chat-message">
                        <div class="chat-avatar chat-avatar-bot">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="chat-bubble chat-bubble-bot">
                                <span class="lang-uk">Вітаю! Я - ваш AI-помічник для подорожей Україною з доступом до найсвіжішої інформації. Запитуйте про будь-які пам'ятки, маршрути чи практичні поради!</span>
                                <span class="lang-en" style="display: none;">Hello! I'm your AI travel assistant for Ukraine with access to the latest information. Ask about any attractions, routes or practical travel tips!</span>
                            </div>
                            <div class="chat-timestamp">
                                <span id="bot-timestamp"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Напишіть повідомлення...">
                    <button class="chat-send-btn" id="chat-send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Кнопка для виклику чату -->
    <div class="chat-toggle-btn pulse" id="chat-toggle-btn">
        <i class="fas fa-comments"></i>
    </div>
    
    <footer>
        <div class="footer-container">
            <div class="footer-logo">
                <h3>Ukraine365</h3>
                <p class="lang-uk">Відкривай Україну разом з нами</p>
                <p class="lang-en" style="display: none;">Discover Ukraine with us</p>
            </div>
            
            <div class="footer-links">
                <div class="footer-links-column">
                    <h4 class="lang-uk">Навігація</h4>
                    <h4 class="lang-en" style="display: none;">Navigation</h4>
                    <ul>
                        <li><a href="#" class="lang-uk">Головна</a><a href="#" class="lang-en" style="display: none;">Home</a></li>
                        <li><a href="#" class="lang-uk">Про нас</a><a href="#" class="lang-en" style="display: none;">About Us</a></li>
                        <li><a href="#" class="lang-uk">Допомогти проєкту</a><a href="#" class="lang-en" style="display: none;">Support the Project</a></li>
                        
                    </ul>
                </div>
                
                <div class="footer-links-column social-links">
                    <h4 class="lang-uk">Соціальні мережі</h4>
                    <h4 class="lang-en" style="display: none;">Social Media</h4>
                    <div class="social-icons">
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p class="copyright lang-uk">© 2025 Ukraine365 - Всі права захищені</p>
            <p class="copyright lang-en" style="display: none;">© 2025 Ukraine365 - All rights reserved</p>
        </div>
    </footer>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/turf@6/turf.min.js"></script>
    <script>
        // База даних місць з координатами та перекладами
        const places = [
            {
                id: 1,
                name: "Печера Атлантида ",
                name_en: "Cave 'Atlantis' ",
                description: "Унікальна печера з кристалами гіпсу.",
                description_en: "Unique cave with gypsum crystals.",
                image: "https://ekotur.com.ua/wp-content/uploads/2022/07/156.jpg",
                interests: ["nature", "adventure"],
                location: "Хмельниччина",
                location_en: "Khmelnytskyi region",
                rating: 4.8,
                coordinates: [48.59855878912615, 26.34475371453334] 
            },
            {
                id: 2,
                name: "Тараканівський форт",
                name_en: "Tarakaniv Fort",
                description: "Загадкова покинута фортеця XIX століття.",
                description_en: "Mysterious abandoned fortress of the 19th century.",
                image: "https://vidviday.ua/blog/wp-content/uploads/2018/04/Tarakaniv-fort-06-w-1024x768.jpg",
                interests: ["history", "culture", "architecture"],
                location: "Рівненщина",
                location_en: "Rivne region",
                rating: 4.9,
                coordinates: [50.362948420585525, 25.71626815712098]
            },
            {
                id: 3,
                name: "Дендропарк Софіївка ",
                name_en: "Arboretum Sofiyivka",
                description: "Один із найкрасивіших парків України в романтичному стилі.",
                description_en: "Оne of the most beautiful parks in Ukraine in a romantic style.",
                image: "https://tamtour.com.ua/image/042/005/cc826ef6-ba38-409e-8105-ded7b8835626.jpeg",
                interests: ["relax", "culture", "nature"],
                location: "Умань",
                location_en: "Uman",
                rating: 4.7,
                coordinates: [48.75698489392953, 30.2357490288946]
            },
            {
                id: 4,
                name: "Київ",
                name_en: "Kyiv",
                description: "Столиця України з багатою історією та сучасною культурою.",
                description_en: "The capital of Ukraine with rich history and modern culture.",
                image: "https://encrypted-tbn1.gstatic.com/licensed-image?q=tbn:ANd9GcT4Krf803d0SnMepWlm1lW8XIJiPOtrZTRDCxVjqiiosoInhih1wG4YilJQyRYhPCCuvL3OU3cBDPHQ_UWtalWwWaKAclJR17Bp80s5og",
                interests: ["history", "culture", "architecture"],
                location: "Київ",
                location_en: "Kyiv",
                rating: 5.0,
                coordinates: [50.4501, 30.5234]
            },
            {
                id: 5,
                name: "Тунель кохання",
                name_en: "Tunnel of Love",
                description: "Романтичне місце для фотосесій, створене природою та залізничною колією.",
                description_en: "Romantic place for photo shoots, created by nature and the railway track.",
                image: "https://f.rivne.travel/location/3287/DLomq.jpg",
                interests: ["nature", "relax"],
                location: "Рівненщина",
                location_en: "Rivne region",
                rating: 4.7,
                coordinates: [50.75059071906591, 26.043267945747615]
            },
            {
                id: 6,
                name: "Кам'янець-Подільський",
                name_en: "Kamianets-Podilskyi",
                description: "Місто-фортеця з дивовижною історією та архітектурою.",
                description_en: "Fortress city with amazing history and architecture.",
                image: "https://tamtour.com.ua/image/410/003/e1141d8077f72563dfbb304ca0c76b59-01-kamenets-podolskiy-depositphotos-41792869-original.jpg",
                interests: ["history", "architecture", "culture"],
                location: "Кам'янець-Подільський",
                location_en: "Kamianets-Podilskyi",
                rating: 4.7,
                coordinates: [48.6767, 26.5833]
            },
            {
                id: 7,
                name: "Буковель",
                name_en: "Bukovel",
                description: "Найбільший гірськолижний курорт України.",
                description_en: "The largest ski resort in Ukraine.",
                image: "https://vidviday.ua/storage/media/place/20712/bukovel-zyma-22.jpg",
                interests: ["nature", "adventure", "relax"],
                location: "Франківщина",
                location_en: "Ivano-Frankivsk region",
                rating: 4.6,
                coordinates: [48.3597, 24.4058]
            },
            {
                id: 8,
                name: "Шацькі озера",
                name_en: "Shatski Lakes",
                description: "Група з понад 30 озер з кришталево чистою водою.",
                description_en: "Group of over 30 lakes with crystal clear water.",
                image: "https://shatsk.rayon.in.ua/storage/cache/images/upload/news/6/2021-08/31-3E5tsU30/700x371-612e292d98690.webp",
                interests: ["nature", "relax"],
                location: "Волинщина",
                location_en: "Volyn region",
                rating: 4.5,
                coordinates: [51.5055, 23.9255]
            },
            {
                id: 9,
                name: "Хотин",
                name_en: "Khotyn",
                description: "Середньовічна фортеця, один з найбільш вражаючих замків України.",
                description_en: "Medieval fortress, one of the most impressive castles in Ukraine.",
                image: "https://images.unsplash.com/photo-1564585222527-c2777a5bc6cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                interests: ["history", "architecture"],
                location: "Західна Україна",
                location_en: "Western Ukraine",
                rating: 4.4,
                coordinates: [48.5167, 26.5000]
            },
            {
                id: 10,
                name: "Полтава",
                name_en: "Poltava",
                description: "Історичне місто, відоме завдяки Полтавській битві та українській культурі.",
                description_en: "Historic city known for the Battle of Poltava and Ukrainian culture.",
                image: "https://images.unsplash.com/photo-1558005530-a7958896ec60?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                interests: ["history", "culture", "gastronomy"],
                location: "Центральна Україна",
                location_en: "Central Ukraine",
                rating: 4.3,
                coordinates: [49.5883, 34.5514]
            },
            {
                id: 11,
                name: "Бакота",
                name_en: "Bakota",
                description: "Затоплене село з мальовничими краєвидами та печерним монастирем.",
                description_en: "Flooded village with picturesque landscapes and a cave monastery.",
                image: "https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                interests: ["nature", "history", "adventure"],
                location: "Західна Україна",
                location_en: "Western Ukraine",
                rating: 4.7,
                coordinates: [48.5917, 27.0167]
            },
            {
                id: 12,
                name: "Чернігів",
                name_en: "Chernihiv",
                description: "Одне з найдавніших міст України з багатою архітектурною спадщиною.",
                description_en: "One of the oldest cities in Ukraine with a rich architectural heritage.",
                image: "https://images.unsplash.com/photo-1526481280693-3bfa7568e0f3?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                interests: ["history", "architecture", "culture"],
                location: "Північна Україна",
                location_en: "Northern Ukraine",
                rating: 4.4,
                coordinates: [51.4982, 31.2893]
            }
        ];
        
        // Обробка вибору інтересів та безпеки
        const interestOptions = document.querySelectorAll('.interest-option');
        const findButton = document.getElementById('find-button');
        const resultsSection = document.getElementById('results');
        const recommendationsContainer = document.getElementById('recommendations-container');
        const viewMapBtn = document.getElementById('view-map-btn');
        const mapContainer = document.getElementById('map-container');
        const placeMarkersToggle = document.getElementById('place-markers-toggle');
        
        let map;
        let markers = [];
        let filteredPlaces = [];
        let selectedInterests = [];
        let minimumSafetyDistance = 100; // значення відстані за замовчуванням у км
        let frontLineLayer = null;
        let safeZoneLayer = null;
        let combatMarkersLayer = null;
        let combatZoneLayer = null;
        let mapLegend = null;
        let updatesInterval = null; // Інтервал для оновлення даних
        
        // Приблизна лінія фронту (координати є спрощеними і служать лише для демонстрації)
        // У реальному додатку ці дані мають оновлюватись із зовнішнього джерела
        const frontLineData = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Лінія фронту"
                    },
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [38.35, 50.05], // Північна точка біля кордону з Росією
                            [38.25, 49.90], // Північна Харківська область
                            [38.01, 49.65], // Куп'янський напрямок
                            [37.95, 49.32], // Район Сватового
                            [37.85, 49.03], // Кремінський напрямок
                            [38.10, 48.92], // Лисичанськ
                            [38.01, 48.60], // Бахмутський напрямок
                            [37.83, 48.21], // Авдіївський напрямок
                            [37.63, 47.95], // Вугледарський напрямок
                            [37.25, 47.78], // Запорізький напрямок
                            [36.85, 47.50], // Район Токмака
                            [36.20, 47.10], // Район Мелітополя
                            [35.30, 46.75], // Херсонський напрямок
                            [33.90, 46.50], // Південно-західний напрямок
                            [32.85, 46.35],  // Кінцева точка на півдні
                            [32.00, 46.20]  // Додаткова точка біля узбережжя Чорного моря
                        ]
                    }
                }
            ]
        };
        
        // Гарячі точки бойових дій (приблизні дані для демонстрації)
        const combatHotspots = [
            { name: "Бахмут", name_en: "Бахмут", coordinates: [38.01, 48.60], intensity: "високий", intensity_en: "high" },
            { name: "Авдіївка", name_en: "Авдіївка", coordinates: [37.83, 48.21], intensity: "високий", intensity_en: "high" },
            { name: "Вугледар", name_en: "Вугледар", coordinates: [37.30, 47.78], intensity: "середній", intensity_en: "medium" },
            { name: "Куп'янськ", name_en: "Куп'янськ", coordinates: [37.62, 49.72], intensity: "високий", intensity_en: "high" },
            { name: "Часів Яр", name_en: "Часів Яр", coordinates: [38.00, 48.58], intensity: "високий", intensity_en: "high" },
            { name: "Торецьк", name_en: "Торецьк", coordinates: [37.85, 48.38], intensity: "середній", intensity_en: "medium" },
            { name: "Покровськ", name_en: "Покровськ", coordinates: [37.18, 48.28], intensity: "середній", intensity_en: "medium" },
            { name: "Робітне", name_en: "Робітне", coordinates: [36.80, 47.45], intensity: "високий", intensity_en: "high" }
        ];
        
        // Змінна для зберігання поточної мови (uk - українська, en - англійська)
        let currentLanguage = 'uk';
        
        // Функція для перемикання мови
        function switchLanguage() {
            // Змінюємо поточну мову
            currentLanguage = currentLanguage === 'uk' ? 'en' : 'uk';
            
            // Оновлюємо текст кнопки перемикання мови
            const langSwitchBtn = document.getElementById('lang-switch');
            langSwitchBtn.textContent = currentLanguage === 'uk' ? 'English' : 'Українська';
            
            // Показуємо/ховаємо елементи відповідно до обраної мови
            document.querySelectorAll('.lang-uk, .lang-en').forEach(el => {
                if (el.classList.contains(`lang-${currentLanguage}`)) {
                    el.style.display = '';
                } else {
                    el.style.display = 'none';
                }
            });
            
            // Якщо карта ініціалізована, оновлюємо легенду та маркери
            if (map) {
                // Оновлюємо маркери бойових дій для відображення локалізованих назв
                addCombatMarkers();
                
                // Оновлюємо легенду
                if (mapLegend) {
                    createMapLegend();
                }
                
                // Якщо є фільтровані місця, оновлюємо їх на карті
                if (filteredPlaces.length > 0) {
                    showFilteredPlacesOnMap();
                }
            }
            
            // Перерендеримо рекомендації, якщо вони вже відображені
            if (!document.getElementById('results').classList.contains('hidden')) {
                renderRecommendations();
            }
        }
        
        // Додаємо обробник для кнопки перемикання мови
        document.getElementById('lang-switch').addEventListener('click', switchLanguage);
        
        // Додаємо обробники для кнопок пошуку англійською версією
        document.getElementById('find-button-en').addEventListener('click', function() {
            document.getElementById('find-button').click();
        });
        
        document.getElementById('view-map-btn-en').addEventListener('click', function() {
            document.getElementById('view-map-btn').click();
        });
        
        // Додаємо функцію для рендерингу рекомендацій з урахуванням мови
        function renderRecommendations() {
            recommendationsContainer.innerHTML = '';
            
            if (filteredPlaces.length === 0) {
                const noResultsText = currentLanguage === 'uk' ? 
                    `<p class="no-results">На жаль, не знайдено безпечних місць за вашими інтересами та параметрами безпеки.</p>
                    <p>Спробуйте зменшити безпечну відстань або обрати інші інтереси.</p>` :
                    `<p class="no-results">Unfortunately, no safe places were found according to your interests and safety parameters.</p>
                    <p>Try reducing the safe distance or choosing different interests.</p>`;
                    
                recommendationsContainer.innerHTML = noResultsText;
                viewMapBtn.classList.add('hidden');
                document.getElementById('view-map-btn-en').classList.add('hidden');
            } else {
                filteredPlaces.forEach(place => {
                    // Для кожного місця обчислюємо відстань до лінії фронту
                    const distance = calculateDistanceToFrontLine([place.coordinates[1], place.coordinates[0]]);
                    const safety = getSafetyLevel(distance);
                    
                    // Створення картки місця
                    const placeCard = document.createElement('div');
                    placeCard.className = 'place-card';
                    
                    // Кількість співпадінь інтересів
                    const matchCount = place.interests.filter(interest => selectedInterests.includes(interest)).length;
                    
                    // Отримуємо переклади назв інтересів
                    const interestTranslations = {
                        nature: { uk: "Природа", en: "Nature" },
                        history: { uk: "Історія", en: "History" },
                        adventure: { uk: "Пригоди", en: "Adventure" },
                        culture: { uk: "Культура", en: "Culture" },
                        gastronomy: { uk: "Гастрономія", en: "Gastronomy" },
                        relax: { uk: "Відпочинок", en: "Relaxation" },
                        architecture: { uk: "Архітектура", en: "Architecture" },
                        festivals: { uk: "Фестивалі", en: "Festivals" }
                    };
                    
                    // Іконки для інтересів
                    const interestIcons = {
                        nature: "tree",
                        history: "landmark",
                        adventure: "hiking",
                        culture: "theater-masks",
                        gastronomy: "utensils",
                        relax: "spa",
                        architecture: "city",
                        festivals: "music"
                    };
                    
                    placeCard.innerHTML = `
                        <div class="place-img">
                            <img src="${place.image}" alt="${currentLanguage === 'uk' ? place.name : place.name_en}">
                        </div>
                        <div class="place-info">
                            <h3>${currentLanguage === 'uk' ? place.name : place.name_en}</h3>
                            <p>${currentLanguage === 'uk' ? place.description : place.description_en}</p>
                            <div class="place-details">
                                <p><i class="fas fa-map-marker-alt"></i> ${currentLanguage === 'uk' ? place.location : place.location_en}</p>
                                <p><i class="fas fa-star"></i> ${place.rating}/5.0</p>
                                <div class="safety-container">
                                    <div class="safety-indicator safety-${safety.level}"></div>
                                    <span class="safety-text">${safety.text}</span>
                                </div>
                            </div>
                            <div class="tags">
                                ${place.interests.map(interest => {
                                    const interestName = interestTranslations[interest][currentLanguage];
                                    const icon = interestIcons[interest];
                                    
                                    const isSelected = selectedInterests.includes(interest);
                                    const tagClass = isSelected ? 'tag selected' : 'tag';
                                    
                                    return `<span class="${tagClass}"><i class="fas fa-${icon}"></i> ${interestName}</span>`;
                                }).join('')}
                            </div>
                        </div>
                    `;
                    
                    // Додаємо обробник кліку на картку для відображення на карті
                    placeCard.addEventListener('click', () => {
                        mapContainer.classList.remove('hidden');
                        
                        // Використовуємо setTimeout щоб дати час на відображення контейнера
                        setTimeout(() => {
                            if (!map) {
                                initMap();
                            }
                            
                            // Важливо для коректного відображення карти після зміни видимості контейнера
                            map.invalidateSize();
                            
                            // Спочатку показуємо всі відфільтровані місця
                            showFilteredPlacesOnMap();
                            
                            // Знаходимо потрібний маркер та відкриваємо його
                            const targetMarker = markers.find(m => {
                                const markerLat = m.getLatLng().lat;
                                const markerLng = m.getLatLng().lng;
                                const placeLat = place.coordinates[0];
                                const placeLng = place.coordinates[1];
                                
                                // Використовуємо приблизне порівняння для уникнення проблем з точністю чисел з плаваючою точкою
                                return Math.abs(markerLat - placeLat) < 0.0001 && Math.abs(markerLng - placeLng) < 0.0001;
                            });
                            
                            if (targetMarker) {
                                // Встановлюємо центр карти на обраному місці та збільшуємо масштаб
                                map.setView(targetMarker.getLatLng(), 10);
                                
                                // Відкриваємо спливаюче вікно маркера
                                targetMarker.openPopup();
                            }
                            
                            // Прокручуємо сторінку до карти
                            mapContainer.scrollIntoView({ behavior: 'smooth' });
                        }, 300);
                    });
                    
                    recommendationsContainer.appendChild(placeCard);
                });
                
                viewMapBtn.classList.remove('hidden');
                if (currentLanguage === 'en') {
                    document.getElementById('view-map-btn-en').classList.remove('hidden');
                }
            }
        }
        
        // Додати обробник для перемикача маркерів бойових дій
        if (placeMarkersToggle) {
            placeMarkersToggle.addEventListener('change', function() {
                if (this.checked && map) {
                    addCombatMarkers();
                } else if (combatMarkersLayer && map) {
                    map.removeLayer(combatMarkersLayer);
                }
            });
        }
        
        // Функція для додавання маркерів бойових дій
        function addCombatMarkers() {
            if (combatMarkersLayer && map) {
                map.removeLayer(combatMarkersLayer);
            }
            
            combatMarkersLayer = L.layerGroup().addTo(map);
            
            combatHotspots.forEach(hotspot => {
                // Створюємо маркер з пульсуючим ефектом
                const intensityColor = "#e74c3c"; // Завжди червоний колір незалежно від інтенсивності
                
                // Основний маркер
                const marker = L.marker([hotspot.coordinates[1], hotspot.coordinates[0]], {
                    icon: L.divIcon({
                        className: 'danger-marker',
                        html: `<div style="position: relative;">
                                <div class="pulsating-circle" style="background-color: ${intensityColor};"></div>
                                <i class="fas fa-exclamation-triangle" style="color: ${intensityColor}; position: relative; z-index: 1000; font-size: 18px; text-shadow: 0px 0px 3px white;"></i>
                              </div>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    })
                }).bindPopup(`
                    <div>
                        <h3>${currentLanguage === 'uk' ? hotspot.name : hotspot.name_en}</h3>
                        <p><strong>${currentLanguage === 'uk' ? 'Інтенсивність бойових дій' : 'Combat intensity'}:</strong> ${currentLanguage === 'uk' ? hotspot.intensity : hotspot.intensity_en}</p>
                        <p><strong>${currentLanguage === 'uk' ? 'Статус' : 'Status'}:</strong> ${currentLanguage === 'uk' ? 'Небезпечна зона' : 'Danger zone'}</p>
                        <p class="front-line-info" style="margin: 10px 0 0 0; font-size: 0.8rem;">
                            ⚠️ ${currentLanguage === 'uk' ? 'Уникайте відвідування цього регіону!' : 'Avoid visiting this region!'}
                        </p>
                    </div>
                `);
                
                // Додаємо підпис
                const label = L.marker([hotspot.coordinates[1], hotspot.coordinates[0]], {
                    icon: L.divIcon({
                        className: 'combat-zone-label',
                        html: `<div>${currentLanguage === 'uk' ? hotspot.name : hotspot.name_en}</div>`,
                        iconSize: [100, 20],
                        iconAnchor: [50, -5]
                    })
                });
                
                combatMarkersLayer.addLayer(marker);
                combatMarkersLayer.addLayer(label);
            });
        }
        
        // Функція для створення легенди карти
        function createMapLegend() {
            if (mapLegend) {
                mapLegend.remove();
            }
            
            mapLegend = L.control({position: 'bottomright'});
            
            mapLegend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'map-legend');
                div.innerHTML = `
                    <div class="legend-title">${currentLanguage === 'uk' ? 'Легенда карти' : 'Map Legend'}</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e74c3c;"></div>
                        <div>${currentLanguage === 'uk' ? 'Лінія фронту' : 'Front line'}</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(231, 76, 60, 0.3); border: 2px dashed #e74c3c;"></div>
                        <div>${currentLanguage === 'uk' ? 'Зона бойових дій (25 км)' : 'Combat zone (25 km)'}</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c;"></div>
                        <div>${currentLanguage === 'uk' ? 'Небезпечна зона' : 'Danger zone'} (${minimumSafetyDistance} ${currentLanguage === 'uk' ? 'км' : 'km'})</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="display:flex; align-items:center; justify-content:center;">
                            <i class="fas fa-exclamation-triangle" style="color: #e74c3c; font-size: 10px;"></i>
                        </div>
                        <div>${currentLanguage === 'uk' ? 'Активні бойові дії' : 'Active combat'}</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2ecc71; border-radius: 50%;"></div>
                        <div>${currentLanguage === 'uk' ? 'Безпечні місця' : 'Safe places'}</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f39c12; border-radius: 50%;"></div>
                        <div>${currentLanguage === 'uk' ? 'Помірно безпечні місця' : 'Moderately safe places'}</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e74c3c; border-radius: 50%;"></div>
                        <div>${currentLanguage === 'uk' ? 'Небезпечні місця' : 'Dangerous places'}</div>
                    </div>
                `;
                return div;
            };
            
            mapLegend.addTo(map);
        }
        
        // Оновлення безпечної зони на основі відстані від лінії фронту
        function updateSafeZone() {
            if (safeZoneLayer) {
                map.removeLayer(safeZoneLayer);
            }
            
            try {
                // Використовуємо turf.js для створення буфера навколо лінії фронту
                const frontLine = frontLineData.features[0];
                const buffered = turf.buffer(frontLine, minimumSafetyDistance, {units: 'kilometers'});
                
                // Розділяємо Україну на безпечну та небезпечну зони
                safeZoneLayer = L.geoJSON(buffered, {
                    style: {
                        fillColor: '#e74c3c',
                        fillOpacity: 0.2,
                        color: '#e74c3c',
                        weight: 2,
                        opacity: 0.8,
                        dashArray: '5, 5'
                    }
                }).addTo(map);
            } catch (error) {
                console.error('Помилка при створенні безпечної зони:', error);
            }
        }
        
        // Функція для створення та відображення зони бойових дій
        function addCombatZone() {
            if (combatZoneLayer && map) {
                map.removeLayer(combatZoneLayer);
            }
            
            try {
                // Створюємо буфер навколо лінії фронту - вужчий, ніж безпечна зона
                const frontLine = frontLineData.features[0];
                const buffered = turf.buffer(frontLine, 25, {units: 'kilometers'});
                
                // Додаємо виділення зони бойових дій
                combatZoneLayer = L.geoJSON(buffered, {
                    style: {
                        fillColor: '#e74c3c',
                        fillOpacity: 0.3,
                        color: '#e74c3c',
                        weight: 3,
                        opacity: 0.9,
                        dashArray: '10, 10'
                    }
                }).addTo(map);
            } catch (error) {
                console.error('Помилка при створенні зони бойових дій:', error);
            }
        }
        
        interestOptions.forEach(option => {
            option.addEventListener('click', () => {
                option.classList.toggle('selected');
            });
        });
        
        // Функція для оновлення даних з сервера (імітація)
        function updateFrontLineData() {
            console.log('Оновлення даних про лінію фронту і бойові дій');
            
            // Оновлюємо шари на карті
            if (map) {
                if (frontLineLayer) {
                    map.removeLayer(frontLineLayer);
                }
                frontLineLayer = L.geoJSON(frontLineData, {
                    style: {
                        color: '#e74c3c',
                        weight: 4,
                        opacity: 1,
                        dashArray: '5, 5'
                    }
                }).addTo(map);
                
                // Оновлюємо зону бойових дій
                addCombatZone();
                
                // Оновлюємо маркери бойових дій
                addCombatMarkers();
                
                // Оновлюємо безпечну зону
                updateSafeZone();
                
                // Оновлюємо легенду
                createMapLegend();
            }
        }
        
        // Функція для запуску періодичного оновлення даних
        function startDataUpdates(intervalMinutes = 30) {
            // Спочатку очищаємо наявний інтервал, якщо він існує
            if (updatesInterval) {
                clearInterval(updatesInterval);
            }
            
            // Встановлюємо новий інтервал
            const intervalMs = intervalMinutes * 60 * 1000;
            updatesInterval = setInterval(updateFrontLineData, intervalMs);
            
            console.log(`Автоматичне оновлення даних встановлено на ${intervalMinutes} хвилин`);
            return updatesInterval;
        }
        
        // Обробник кнопки "Переглянути на карті"
        viewMapBtn.addEventListener('click', () => {
            mapContainer.classList.remove('hidden');
            
            // Це важливо для правильного відображення карти
            setTimeout(() => {
                // Ініціалізуємо карту, якщо ще не ініціалізована
                if (!map) {
                    initMap();
                }
                
                // Карта може потребувати повторної ініціалізації після того, як контейнер стає видимим
                map.invalidateSize();
                
                showFilteredPlacesOnMap();
                
                // Прокручуємо до карти
                mapContainer.scrollIntoView({ behavior: 'smooth' });
            }, 300); // Даємо час на відображення контейнера
        });
        
        findButton.addEventListener('click', () => {
            selectedInterests = [];
            document.querySelectorAll('.interest-option.selected').forEach(selected => {
                selectedInterests.push(selected.dataset.interest);
            });
            
            if (selectedInterests.length === 0) {
                alert(currentLanguage === 'uk' ? 'Будь ласка, оберіть хоча б один інтерес' : 'Please select at least one interest');
                return;
            }
            
            // Фільтрація за інтересами та безпечною відстанню
            filteredPlaces = places.filter(place => {
                // Перевіряємо відстань до лінії фронту
                const isDistanceSafe = calculateDistanceToFrontLine([place.coordinates[1], place.coordinates[0]]) >= minimumSafetyDistance;
                
                // Перевіряємо співпадіння за інтересами
                const hasMatchingInterests = place.interests.some(interest => selectedInterests.includes(interest));
                
                return isDistanceSafe && hasMatchingInterests;
            }).sort((a, b) => {
                // Рахуємо кількість співпадінь інтересів
                const aMatches = a.interests.filter(interest => selectedInterests.includes(interest)).length;
                const bMatches = b.interests.filter(interest => selectedInterests.includes(interest)).length;
                
                // Сортуємо за кількістю співпадінь та рейтингом
                if (aMatches === bMatches) {
                    return b.rating - a.rating;
                }
                return bMatches - aMatches;
            });
            
            // Використовуємо функцію для відображення результатів з перекладом
            renderRecommendations();
            
            resultsSection.classList.remove('hidden');
            mapContainer.classList.add('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        });
        
        // Ініціалізація карти
        function initMap() {
            if (map) {
                map.remove();
            }
            
            // Створюємо карту, центровану на Україні
            map = L.map('map').setView([49.0, 31.0], 6);
            
            // Додаємо базовий шар карти
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Додаємо шар лінії фронту
            frontLineLayer = L.geoJSON(frontLineData, {
                style: {
                    color: '#e74c3c',
                    weight: 4,
                    opacity: 1,
                    dashArray: '5, 5'
                }
            }).addTo(map);
            
            // Додаємо зону бойових дій
            addCombatZone();
            
            // Додаємо маркери бойових дій
            addCombatMarkers();
            
            // Додаємо безпечну зону
            updateSafeZone();
            
            markers = [];
        }
        
        // Додавання маркерів на карту
        function addMarkersToMap(placesToShow) {
            // Перевіряємо, що карта ініціалізована
            if (!map) {
                initMap();
            }
            
            // Очищаємо попередні маркери
            markers.forEach(marker => {
                if (map.hasLayer(marker)) {
                    map.removeLayer(marker);
                }
            });
            markers = [];
            
            // Додаємо нові маркери
            placesToShow.forEach(place => {
                if (place.coordinates && place.coordinates.length === 2) {
                    try {
                        // Для кожного місця обчислюємо відстань до лінії фронту
                        const distance = calculateDistanceToFrontLine([place.coordinates[1], place.coordinates[0]]);
                        const safety = getSafetyLevel(distance);
                        
                        // Створюємо маркер з відповідним кольором
                        const markerIcon = L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background-color: var(--${safety.level === 'high' ? 'success' : safety.level === 'medium' ? 'warning' : 'danger'}); width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;"></div>`,
                            iconSize: [16, 16],
                            iconAnchor: [8, 8]
                        });
                        
                        const marker = L.marker(place.coordinates, { icon: markerIcon })
                            .addTo(map)
                            .bindPopup(`
                                <div class="map-popup">
                                    <h3>${currentLanguage === 'uk' ? place.name : place.name_en}</h3>
                                    <p>${currentLanguage === 'uk' ? place.description : place.description_en}</p>
                                    <p><strong>${currentLanguage === 'uk' ? 'Рейтинг' : 'Rating'}:</strong> ${place.rating}/5</p>
                                    <p><strong>${currentLanguage === 'uk' ? 'Розташування' : 'Location'}:</strong> ${currentLanguage === 'uk' ? place.location : place.location_en}</p>
                                </div>
                            `);
                            
                        markers.push(marker);
                    } catch (error) {
                        console.error(`Помилка при створенні маркера для ${place.name}:`, error);
                    }
                }
            });
            
            // Якщо є маркери, змінюємо межі карти, щоб вмістити всі
            if (markers.length > 0) {
                try {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                } catch (error) {
                    console.error('Помилка при налаштуванні меж карти:', error);
                    // Резервний варіант - показати загальний вид України
                    map.setView([49.0, 31.0], 6);
                }
            } else {
                // Якщо немає маркерів, показуємо загальний вид України
                map.setView([49.0, 31.0], 6);
            }
        }
        
        // Функція для відображення відфільтрованих місць на карті
        function showFilteredPlacesOnMap() {
            addMarkersToMap(filteredPlaces);
        }
        
        // Функція для обчислення відстані до лінії фронту
        function calculateDistanceToFrontLine(coordinates) {
            try {
                const point = turf.point(coordinates);
                const frontLine = turf.lineString(frontLineData.features[0].geometry.coordinates);
                
                // Обчислюємо відстань у кілометрах
                const distance = turf.pointToLineDistance(point, frontLine, {units: 'kilometers'});
                return distance;
            } catch (error) {
                console.error('Помилка при обчисленні відстані до лінії фронту:', error);
                return 999; // Повертаємо велике значення у випадку помилки
            }
        }
        
        // Функція для визначення рівня безпеки місця
        function getSafetyLevel(distance) {
            if (distance >= 150) {
                return {
                    level: 'high',
                    text: currentLanguage === 'uk' ? 'Високий рівень безпеки' : 'High safety level'
                };
            } else if (distance >= 75) {
                return {
                    level: 'medium',
                    text: currentLanguage === 'uk' ? 'Середній рівень безпеки' : 'Medium safety level'
                };
            } else {
                return {
                    level: 'low',
                    text: currentLanguage === 'uk' ? 'Низький рівень безпеки' : 'Low safety level'
                };
            }
        }
        
        // Функціонал для чат-бота
        const chatToggleBtn = document.getElementById('chat-toggle-btn');
        const chatSection = document.getElementById('chat-section');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const chatBody = document.getElementById('chat-body');
        
        // Встановлюємо початковий час повідомлення бота
        document.getElementById('bot-timestamp').textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        // База знань про місця
        const destinationsInfo = {
            "київ": {
                uk: {
                    info: "Київ - столиця України та одне з найдавніших міст Європи. Місто відоме своїми золотими куполами, культурною спадщиною та сучасною атмосферою.",
                    attractions: "Основні пам'ятки: Києво-Печерська Лавра, Софійський собор, Андріївський узвіз, Хрещатик та Майдан Незалежності.",
                    restaurants: "Популярні ресторани: 'Канапа', 'Остання Барикада', 'Chicken Kyiv', 'BAO'.",
                    transport: "Транспорт: розвинена мережа метро, автобуси, трамваї та тролейбуси. Зручно орендувати велосипед або електросамокат для прогулянок центром."
                },
                en: {
                    info: "Kyiv is the capital of Ukraine and one of the oldest cities in Europe. The city is known for its golden domes, cultural heritage, and modern atmosphere.",
                    attractions: "Main attractions: Kyiv-Pechersk Lavra, St. Sophia Cathedral, Andriyivskyy Descent, Khreshchatyk, and Independence Square.",
                    restaurants: "Popular restaurants: 'Kanapa', 'Ostannya Barykada', 'Chicken Kyiv', 'BAO'.",
                    transport: "Transport: Well-developed metro network, buses, trams, and trolleybuses. Convenient to rent a bicycle or e-scooter for exploring the center."
                }
            },
            "львів": {
                uk: {
                    info: "Львів - культурна столиця західної України. Місто чарує середньовічною архітектурою, затишними кав'ярнями та особливою атмосферою.",
                    attractions: "Визначні місця: Площа Ринок, Оперний театр, Високий Замок, Личаківський цвинтар, Вірменський квартал.",
                    restaurants: "Відомі заклади: 'Криївка', 'Гасова Лямпа', 'Мазох-кафе', кав'ярні 'Світ Кави' та 'Львівська Майстерня Шоколаду'.",
                    transport: "Транспорт: трамваї, тролейбуси, маршрутки. Історичний центр найкраще досліджувати пішки."
                },
                en: {
                    info: "Lviv is the cultural capital of western Ukraine. The city captivates with its medieval architecture, cozy cafes, and special atmosphere.",
                    attractions: "Notable places: Market Square, Opera House, High Castle, Lychakiv Cemetery, Armenian Quarter.",
                    restaurants: "Famous establishments: 'Kryivka', 'Gasova Lampa', 'Masoch Cafe', 'Svit Kavy' and 'Lviv Handmade Chocolate' cafes.",
                    transport: "Transport: trams, trolleybuses, minibuses. The historic center is best explored on foot."
                }
            },
            "одеса": {
                uk: {
                    info: "Одеса - перлина біля Чорного моря. Місто відоме пляжами, архітектурою 19 століття та особливим почуттям гумору одеситів.",
                    attractions: "Варто відвідати: Одеський оперний театр, Потьомкінські сходи, Дерибасівську вулицю, катакомби, пляж Аркадія.",
                    restaurants: "Рекомендовані ресторани: 'Компот', 'Дача', 'Фарширована Риба', 'Тавернетта'.",
                    transport: "Транспорт: трамваї, маршрутки, тролейбуси. В сезон працюють морські трамвайчики вздовж узбережжя."
                },
                en: {
                    info: "Odesa is a pearl by the Black Sea. The city is famous for its beaches, 19th-century architecture, and the special sense of humor of its residents.",
                    attractions: "Worth visiting: Odesa Opera House, Potemkin Stairs, Deribasivska Street, catacombs, Arcadia Beach.",
                    restaurants: "Recommended restaurants: 'Kompot', 'Dacha', 'Farshirovannaya Ryba', 'Tavernetta'.",
                    transport: "Transport: trams, minibuses, trolleybuses. During the season, sea trams operate along the coast."
                }
            },
            "кам'янець-подільський": {
                uk: {
                    info: "Кам'янець-Подільський - це місто-фортеця з унікальним поєднанням природного ландшафту та історичної архітектури.",
                    attractions: "Головні пам'ятки: Стара фортеця, Старе місто, каньйон річки Смотрич, Турецький мінарет, Руський та Польський ринки.",
                    restaurants: "Куди сходити: 'Тепло', 'Папа Карло', 'Кава від поліцмейстера'.",
                    transport: "Транспорт: автобуси та маршрутки. Для огляду фортеці та Старого міста краще гуляти пішки."
                },
                en: {
                    info: "Kamianets-Podilskyi is a fortress city with a unique combination of natural landscape and historical architecture.",
                    attractions: "Main attractions: Old Fortress, Old Town, Smotrych River Canyon, Turkish Minaret, Russian and Polish markets.",
                    restaurants: "Where to go: 'Teplo', 'Papa Carlo', 'Coffee from the Police Chief'.",
                    transport: "Transport: buses and minibuses. For viewing the fortress and the Old Town, it's better to walk."
                }
            },
            "буковель": {
                uk: {
                    info: "Буковель - найбільший гірськолижний курорт України, розташований у Карпатах. Чудове місце для активного відпочинку як взимку, так і влітку.",
                    attractions: "Активності: лижі, сноуборд, гірські велосипеди, водоспад Пробій, озеро Молодості, канатна дорога.",
                    restaurants: "Ресторани: 'Корчма Вагон', 'Гражда', 'Колиба'.",
                    transport: "Транспорт: до курорту можна дістатися автобусом з Івано-Франківська. На території працює шатл-бас між готелями."
                },
                en: {
                    info: "Bukovel is the largest ski resort in Ukraine, located in the Carpathians. A great place for active recreation in both winter and summer.",
                    attractions: "Activities: skiing, snowboarding, mountain biking, Probiy waterfall, Youth Lake, cable car.",
                    restaurants: "Restaurants: 'Korchma Vagon', 'Grazhda', 'Kolyba'.",
                    transport: "Transport: the resort can be reached by bus from Ivano-Frankivsk. A shuttle bus operates between hotels in the area."
                }
            }
        };
        
        // Активуємо чат при кліку на кнопку
        chatToggleBtn.addEventListener('click', () => {
            chatSection.classList.toggle('hidden');
            resultsSection.classList.remove('hidden');
            mapContainer.classList.add('hidden');
            
            if (!chatSection.classList.contains('hidden')) {
                chatSection.scrollIntoView({ behavior: 'smooth' });
                setTimeout(() => chatInput.focus(), 500);
            }
        });
        
        // Функція для відправки повідомлення
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            // Додаємо повідомлення користувача
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message chat-message-user';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            userMessage.innerHTML = `
                <div>
                    <div class="chat-bubble chat-bubble-user">${message}</div>
                    <div class="chat-timestamp">${timeString}</div>
                </div>
                <div class="chat-avatar chat-avatar-user">
                    <i class="fas fa-user"></i>
                </div>
            `;
            
            chatBody.appendChild(userMessage);
            chatInput.value = '';
            
            // Прокручуємо чат до останнього повідомлення
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Показуємо індикатор набору тексту
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'chat-message';
            typingIndicator.id = 'typing-indicator';
            typingIndicator.innerHTML = `
                <div class="chat-avatar chat-avatar-bot">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-bubble chat-bubble-bot typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            chatBody.appendChild(typingIndicator);
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Відкладена відповідь бота (асинхронно отримуємо від API)
            try {
                const responseText = await generateResponse(message.toLowerCase());
                
                // Видаляємо індикатор набору
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    chatBody.removeChild(indicator);
                }
                
                // Додаємо відповідь бота
                const botResponse = document.createElement('div');
                botResponse.className = 'chat-message';
                
                const responseTime = new Date();
                const responseTimeString = responseTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                botResponse.innerHTML = `
                    <div class="chat-avatar chat-avatar-bot">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <div class="chat-bubble chat-bubble-bot">${responseText}</div>
                        <div class="chat-timestamp">${responseTimeString}</div>
                    </div>
                `;
                
                chatBody.appendChild(botResponse);
                chatBody.scrollTop = chatBody.scrollHeight;
            } catch (error) {
                console.error("Error generating response:", error);
                
                // Видаляємо індикатор набору
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    chatBody.removeChild(indicator);
                }
                
                // Додаємо повідомлення про помилку
                const errorResponse = document.createElement('div');
                errorResponse.className = 'chat-message';
                
                const responseTime = new Date();
                const responseTimeString = responseTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                const errorText = currentLanguage === 'uk' ? 
                    'Вибачте, виникла помилка при отриманні відповіді. Будь ласка, спробуйте пізніше.' : 
                    'Sorry, there was an error getting a response. Please try again later.';
                
                errorResponse.innerHTML = `
                    <div class="chat-avatar chat-avatar-bot">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <div class="chat-bubble chat-bubble-bot">${errorText}</div>
                        <div class="chat-timestamp">${responseTimeString}</div>
                    </div>
                `;
                
                chatBody.appendChild(errorResponse);
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }
        
        // Додаємо змінну для зберігання історії розмови
        let conversationHistory = [];
        
        // Функція для генерації відповіді на основі запиту
        async function generateResponse(query) {
            // Спочатку перевіряємо локальну базу знань для швидкої відповіді
            let foundDestination = null;
            
            for (const destination in destinationsInfo) {
                if (query.toLowerCase().includes(destination)) {
                    foundDestination = destination;
                    break;
                }
            }
            
            // Якщо знайдено інформацію в локальній базі, відразу повертаємо
            if (foundDestination) {
                const destInfo = destinationsInfo[foundDestination][currentLanguage];
                const response = `<p><strong>${foundDestination.charAt(0).toUpperCase() + foundDestination.slice(1)}</strong></p>
                        <p>${destInfo.info}</p>
                        <p><strong>${currentLanguage === 'uk' ? 'Пам\'ятки' : 'Attractions'}:</strong> ${destInfo.attractions}</p>
                        <p><strong>${currentLanguage === 'uk' ? 'Де поїсти' : 'Where to eat'}:</strong> ${destInfo.restaurants}</p>
                        <p><strong>${currentLanguage === 'uk' ? 'Транспорт' : 'Transport'}:</strong> ${destInfo.transport}</p>`;
                
                // Зберігаємо в історії
                conversationHistory.push({
                    role: "user",
                    content: query
                });
                conversationHistory.push({
                    role: "assistant",
                    content: response
                });
                
                return response;
            }
            
            // Деякі ключові запити також можна обробити локально
            if (query.includes('привіт') || query.includes('hello') || query.includes('hi')) {
                const response = currentLanguage === 'uk' ? 
                    'Привіт! Чим я можу допомогти з плануванням вашої подорожі Україною?' : 
                    'Hello! How can I help you with planning your trip in Ukraine?';
                
                conversationHistory.push({
                    role: "user",
                    content: query
                });
                conversationHistory.push({
                    role: "assistant",
                    content: response
                });
                
                return response;
            }
            
            // Інакше використовуємо OpenAI API
            try {
                const systemPrompt = currentLanguage === 'uk' ?
                    `Ти досвідчений туристичний асистент України. Твої відповіді мають бути:
                    1. Точними і правдивими - якщо ти не впевнений в інформації, чесно скажи про це
                    2. Актуальними - враховуй поточну ситуацію в Україні
                    3. Структурованими - розділяй інформацію на логічні блоки
                    4. Корисними - надавай практичні поради та рекомендації
                    5. Безпечними - завжди враховуй аспекти безпеки подорожей
                    Не використовуй markdown-форматування у відповідях. Відповідай українською мовою.` :
                    `You are an experienced travel assistant for Ukraine. Your answers should be:
                    1. Accurate and truthful - if you're not sure about information, honestly say so
                    2. Current - consider the present situation in Ukraine
                    3. Structured - divide information into logical blocks
                    4. Useful - provide practical advice and recommendations
                    5. Safety-conscious - always consider travel safety aspects
                    Don't use markdown formatting in responses. Answer in English.`;
                
                const response = await callOpenAI(query, systemPrompt);
                
                // Зберігаємо в історії
                conversationHistory.push({
                    role: "user",
                    content: query
                });
                conversationHistory.push({
                    role: "assistant",
                    content: response
                });
                
                return response;
            } catch (error) {
                console.error("Error calling OpenAI API:", error);
                return currentLanguage === 'uk' ? 
                    'Вибачте, зараз у мене виникли труднощі з отриманням інформації. Спробуйте перефразувати ваше запитання або запитати про щось інше.' : 
                    'Sorry, I am having trouble retrieving information right now. Try rephrasing your question or asking about something else.';
            }
        }
        
        // Функція для виклику OpenAI API
        async function callOpenAI(userQuery, systemPrompt) {
            const OPENAI_API_KEY = "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";
            
            try {
                // Обмежуємо історію останніми 10 повідомленнями для економії токенів
                const recentHistory = conversationHistory.slice(-10);
                
                // Формуємо повідомлення для API, включаючи історію розмови
                const messages = [
                    {
                        role: "system",
                        content: systemPrompt
                    },
                    ...recentHistory,
                    {
                        role: "user",
                        content: userQuery
                    }
                ];
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: messages,
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                let response_text = data.choices[0].message.content;
                
                // Видаляємо markdown-символи та форматуємо текст
                response_text = response_text
                    .replace(/#{1,3}\s?/g, '')
                    .replace(/\*\*/g, '')
                    .replace(/__/g, '')
                    .replace(/\n{3,}/g, '\n\n')
                    .trim();
                
                // Форматуємо текст у HTML з абзацами
                response_text = response_text
                    .split('\n\n')
                    .map(paragraph => `<p>${paragraph.trim()}</p>`)
                    .join('');
                
                return response_text;
            } catch (error) {
                console.error("OpenAI API error:", error);
                throw error;
            }
        }
        
        // Обробник для кнопки відправки
        chatSendBtn.addEventListener('click', sendMessage);
        
        // Обробник для Enter в полі вводу
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Оновлення плейсхолдера інпута в залежності від мови
        function updateChatPlaceholder() {
            chatInput.placeholder = currentLanguage === 'uk' ? 'Напишіть повідомлення...' : 'Type a message...';
        }
        
        // Додаємо оновлення плейсхолдера при зміні мови
        document.getElementById('lang-switch').addEventListener('click', () => {
            setTimeout(updateChatPlaceholder, 100);
        });
    </script>
</body>
</html>
